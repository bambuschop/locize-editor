!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).locizeEditor=e()}(this,function(){"use strict";function t(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t){return(n="function"==typeof Symbol&&"symbol"===e(Symbol.iterator)?function(t){return e(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":e(t)})(t)}function o(t){var e,o,i={top:0,left:0,right:0,bottom:0},r=t&&t.ownerDocument;if(!(e=r&&r.documentElement))return i;"undefined"!==n(t.getBoundingClientRect)&&(i=t.getBoundingClientRect()),o=function(t){return null!=(e=t)&&e===e.window?t:9===t.nodeType&&t.defaultView;var e}(r);var s=i.top+o.pageYOffset-e.clientTop,a=i.left+o.pageXOffset-e.clientLeft;return{top:s,left:a,right:a+(i.right-i.left),bottom:s+(i.bottom-i.top)}}function i(t,e){var n=t,o=void 0!==e.options.nsSeparator?e.options.nsSeparator:":";if(t.indexOf(o)>-1){var i=t.split(o);i.shift(),n=i.join(o)}return n}function r(t,e,n){var o=n.options.defaultNS,i=n.options.nsSeparator||":";if(t.indexOf(i)>-1)o=t.split(i)[0];else{var r;!function t(e){var n=e.getAttribute&&e.getAttribute("i18next-options");if(n||(n=e.getAttribute&&e.getAttribute("data-i18next-options")),n||(n=e.getAttribute&&e.getAttribute("i18n-options")),n||(n=e.getAttribute&&e.getAttribute("data-i18n-options")),n){var o={};try{o=JSON.parse(n)}catch(t){}o.ns&&(r=o.ns)}r||(r=e.getAttribute&&e.getAttribute("i18next-ns")),r||(r=e.getAttribute&&e.getAttribute("data-i18next-ns")),r||(r=e.getAttribute&&e.getAttribute("i18n-ns")),r||(r=e.getAttribute&&e.getAttribute("data-i18n-ns")),!r&&e.parentElement&&t(e.parentElement)}(e),r&&(o=r)}return o}function s(t){if("undefined"==typeof window)return!1;for(var e=window.location.search.substring(1).split("&"),n=0;n<e.length;n++){var o=e[n].split("=");if(o[0]==t)return o[1]}return!1}var a='font-family: "Helvetica", "Arial", sans-serif; font-size: 14px; color: #fff; border: none; font-weight: 300; height: 30px; line-height: 30px; padding: 0; text-align: center; min-width: 90px; text-decoration: none; text-transform: uppercase; text-overflow: ellipsis; white-space: nowrap; outline: none; cursor: pointer;';var l={url:"https://www.locize.app",openDashboard:!1,enabled:!1,enableByQS:"locize",toggleKeyCode:24,toggleKeyModifier:"ctrlKey",lngOverrideQS:"useLng",lngOverride:null,hasNamespacePrefixed:!1,autoOpen:!0,onEditorSaved:function(t,e){},mode:s("locizeMode")||"iframe",iframeContainerStyle:"z-index: 2147480000; position: fixed; top: 0; right: 0; bottom: 0; width: 600px; box-shadow: -3px 0 5px 0 rgba(0,0,0,0.5);",iframeStyle:"height: 100%; width: 600px; border: none;",bodyStyle:"margin-right: 605px;",locizeEditorWindow:{appendTarget:!1,containerClasses:!1},locizeEditorToggle:{appendTarget:!1,containerClasses:!1,title:!1}};return{type:"3rdParty",init:function(e){var n,o=this;e&&!e.init&&(e={languages:[(n=e).lng],nsSeparator:n.nsSeparator||":",options:{editor:n,backend:n,defaultNS:n.defaultNS}}),this.enabled=!1,this.i18next=e,this.options=function(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{},i=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(o).filter(function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable}))),i.forEach(function(n){t(e,n,o[n])})}return e}({},l,e.options.editor),this.handler=this.handler.bind(this),this.handleSavedMissing=this.handleSavedMissing.bind(this),(this.options.enabled||this.options.enableByQS&&"true"===s(this.options.enableByQS))&&setTimeout(function(){o.options.autoOpen&&o.open()},500),document.addEventListener("keypress",function(t){t[o.options.toggleKeyModifier]&&t.which===o.options.toggleKeyCode&&(o.enabled?o.off():o.on())}),window.addEventListener("message",function(t){t.data[o.options.toggleKeyModifier]&&t.data.which===o.options.toggleKeyCode&&(o.enabled?o.off():o.on()),"savedSegments"===t.data.type&&o.options.onEditorSaved(t.data.lng,t.data.ns)})},handler:function(t){var e=this,n=function(t){if(t.srcElement&&1===t.srcElement.nodeType)return t.srcElement.getAttribute&&""===t.srcElement.getAttribute("ignorelocizeeditor")?null:t.srcElement;var e;if(t.originalEvent&&t.originalEvent.explicitOriginalTarget)e=t.originalEvent.explicitOriginalTarget;else{var n=t.srcElement;if(n.getAttribute&&""===n.getAttribute("ignorelocizeeditor"))return null;for(var i,r=t.pageX,s=t.pageY,a=(o(n),0),l=0;l<n.childNodes.length;l++){var d=n.childNodes[l],c=o(d);1===d.nodeType&&c.bottom<s&&(a=l+1),!i&&c.top+(d.clientHeight||0)>s&&(i=l)}a+1>n.childNodes.length&&(a=n.childNodes.length-1),i||(i=n.childNodes.length);for(var p=a;p<i;p++){var u=n.childNodes[p];if(o(u).left>r)break;u&&8!==u.nodeType&&(e=u)}}return e}(t);if(n){t.preventDefault(),t.stopPropagation();var a=n.textContent||n.text&&n.text.innerText||n.placeholder;if("string"==typeof a){var l=a.replace(/\n +/g,"").trim(),d=function(){var t={message:"searchForKey",projectId:e.i18next.options.backend.projectId,version:e.i18next.options.backend.version||"latest",lng:s(e.options.lngOverrideQS)||e.options.lngOverride||e.i18next.languages[0],ns:r(l,n,e.i18next),token:e.options.hasNamespacePrefixed?i(l,e.i18next):l};if(t.lng&&"cimode"!==t.lng.toLowerCase()||(t.lng=e.i18next.options.backend.referenceLng),e.options.handler)return e.options.handler(t);e.locizeInstance.postMessage(t,e.options.url),e.locizeInstance.focus()};this.options.autoOpen&&("iframe"!==this.options.mode&&!this.locizeInstance||this.locizeInstance.closed)?(this.open(),setTimeout(function(){d()},3e3)):d()}}},handleSavedMissing:function(t,e){if(this.locizeInstance&&!this.locizeInstance.closed){var n={message:"savedMissings",projectId:this.i18next.options.backend.projectId,version:this.i18next.options.backend.version||"latest",lng:t,ns:e};this.locizeInstance.postMessage(n,this.options.url)}},open:function(){var t=this.options.url;this.options.openDashboard||(t="".concat(t,"/pid/").concat(this.options.projectId||this.i18next.options.backend.projectId,"/v/").concat(this.i18next.options.backend.version||"latest")),"iframe"===this.options.mode?this.locizeInstance=function(t,e){e.locizeEditorWindow.appendTarget&&(e.iframeContainerStyle="position: absolute; top: 0; right: 0; bottom: 0; left: 0;",e.iframeStyle+=" width: 100%;");var n=document.createElement("div");n.setAttribute("style",e.iframeContainerStyle),n.setAttribute("ignorelocizeeditor",""),n.setAttribute("translated",""),e.locizeEditorWindow.containerClasses&&(e.locizeEditorWindow.containerClasses.length>1?e.locizeEditorWindow.containerClasses.split(" "):e.locizeEditorWindow.containerClasses).forEach(function(t){n.classList.add(t)});var o=document.createElement("iframe");if(o.setAttribute("style",e.iframeStyle),o.setAttribute("ignorelocizeeditor",""),o.setAttribute("translated",""),o.setAttribute("src",t),n.appendChild(o),e.locizeEditorWindow.appendTarget)e.locizeEditorWindow.appendTarget.appendChild(n);else{document.body.appendChild(n);var i=document.body.getAttribute("style");document.body.setAttribute("style","".concat(i,"; ").concat(e.bodyStyle))}return o.contentWindow}(t,this.options):this.locizeInstance=window.open(t),this.toggleUI=function(t,e,n){var o=document.createElement("div"),i='font-family: "Helvetica", "Arial", sans-serif; bottom: 20px; right: 20px; padding: 10px; background-color: #fff; border: solid 1px #1976d2; box-shadow: 0px 1px 2px 0px rgba(0,0,0,0.5);';n.locizeEditorToggle.appendTarget?i+="position: absolute;":i+=" z-index: 2147483647; position: fixed;",o.setAttribute("style",i),o.setAttribute("ignorelocizeeditor",""),o.setAttribute("translated",""),n.locizeEditorToggle.containerClasses&&(n.locizeEditorToggle.containerClasses.length>1?n.locizeEditorToggle.containerClasses.split(" "):n.locizeEditorToggle.containerClasses).forEach(function(t){o.classList.add(t)});var r=document.createElement("h4");r.id="locize-title",r.innerHTML=n.locizeEditorToggle.title||"locize editor",r.setAttribute("style",'font-family: "Helvetica", "Arial", sans-serif; font-size: 14px; margin: 0 0 5px 0; color: #1976d2; font-weight: 300;'),r.setAttribute("ignorelocizeeditor",""),o.appendChild(r);var s=document.createElement("button");s.innerHTML="On",s.setAttribute("style","".concat(a," display: none; background-color: #54A229;")),s.onclick=e,s.setAttribute("ignorelocizeeditor",""),o.appendChild(s);var l=document.createElement("button");return l.innerHTML="Off",l.setAttribute("style","".concat(a," display: none; background-color: #D50000;")),l.onclick=t,l.setAttribute("ignorelocizeeditor",""),o.appendChild(l),n.locizeEditorToggle.appendTarget?n.locizeEditorToggle.appendTarget.appendChild(o):document.body.appendChild(o),function(t){s.style.display=t?"block":"none",l.style.display=t?"none":"block"}}(this.on.bind(this),this.off.bind(this),this.options),this.on()},on:function(){document.body.addEventListener("click",this.handler,!0),this.toggleUI||this.open(),this.toggleUI(!0),this.enabled=!0},off:function(){document.body.removeEventListener("click",this.handler,!0),this.toggleUI||this.open(),this.toggleUI(!1),this.enabled=!1}}});
